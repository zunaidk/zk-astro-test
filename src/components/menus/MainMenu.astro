---
/**
 * Main Menu Component
 * Auto-generated by PhantomWP
 * 
 * Edit this menu via the Menu Builder in the IDE,
 * or customize it directly here.
 * 
 * Usage: <MainMenu />
 */
import { getNavigationPages, isActivePath } from '../../lib/navigation';

const currentPath = Astro.url.pathname;

// Auto-discover pages from the pages folder
const discoveredPages = await getNavigationPages();

// Build menu items: Home + discovered pages
const menuItems = [
    { id: 'home', type: 'home', label: 'Home', url: '/' },
    ...discoveredPages.map(page => ({
        id: 'page_' + page.slug,
        type: 'page' as const,
        label: page.title,
        url: page.url,
    }))
];
---

<!-- Desktop Navigation -->
<nav class="hidden md:flex items-center gap-1" aria-label="Main navigation">
    {menuItems.map((item) => (
        item.children && item.children.length > 0 ? (
            /* Dropdown Menu Item */
            <div class="relative group/dropdown">
                <button 
                    type="button"
                    class={`relative px-4 py-2 text-sm font-medium rounded-xl transition-all duration-300 cursor-pointer flex items-center gap-1 ${isActivePath(currentPath, item.url) ? 'text-primary bg-primary/10' : 'text-content-light hover:text-content hover:bg-surface-alt'}`}
                >
                    {item.label}
                    <svg class="w-4 h-4 transition-transform group-hover/dropdown:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                <div class="absolute top-full left-0 pt-2 opacity-0 invisible group-hover/dropdown:opacity-100 group-hover/dropdown:visible transition-all duration-200 z-50">
                    <div class="bg-surface border border-outline/50 rounded-xl shadow-xl py-2 min-w-48">
                        <a 
                            href={item.url}
                            class={`block px-4 py-2 text-sm transition-colors no-underline cursor-pointer ${isActivePath(currentPath, item.url, true) ? 'text-primary bg-primary/5' : 'text-content-light hover:text-content hover:bg-surface-alt'}`}
                        >
                            {item.label}
                        </a>
                        <div class="border-t border-outline/30 my-1"></div>
                        {item.children.map((child) => (
                            <a 
                                href={child.url}
                                class={`block px-4 py-2 text-sm transition-colors no-underline cursor-pointer ${isActivePath(currentPath, child.url, true) ? 'text-primary bg-primary/5' : 'text-content-light hover:text-content hover:bg-surface-alt'}`}
                            >
                                {child.label}
                            </a>
                        ))}
                    </div>
                </div>
            </div>
        ) : (
            /* Regular Menu Item */
            <a 
                href={item.url}
                target={item.type === 'custom' && item.url.startsWith('http') ? '_blank' : undefined}
                rel={item.type === 'custom' && item.url.startsWith('http') ? 'noopener noreferrer' : undefined}
                class={`relative px-4 py-2 text-sm font-medium rounded-xl transition-all duration-300 no-underline cursor-pointer ${isActivePath(currentPath, item.url, item.url === '/') ? 'text-primary bg-primary/10' : 'text-content-light hover:text-content hover:bg-surface-alt'}`}
            >
                {item.label}
            </a>
        )
    ))}
</nav>

<!-- Mobile Hamburger Button -->
<button
    type="button"
    class="md:hidden flex items-center justify-center w-10 h-10 text-content-light hover:text-content hover:bg-surface-alt rounded-xl transition-colors cursor-pointer"
    aria-label="Toggle menu"
    id="main-menu-toggle"
>
    <svg class="w-6 h-6 hamburger-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
    </svg>
    <svg class="w-6 h-6 hidden close-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
    </svg>
</button>

<!-- Mobile Menu Panel -->
<div class="hidden md:hidden fixed inset-0 z-50" id="main-menu-mobile">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="main-menu-overlay"></div>
    <nav class="absolute top-0 right-0 w-80 max-w-[85vw] h-full bg-surface shadow-xl overflow-y-auto" aria-label="Mobile navigation">
        <div class="p-4 border-b border-outline/50 flex items-center justify-between">
            <span class="font-semibold text-content">Menu</span>
            <button type="button" class="p-2 text-content-light hover:text-content rounded-lg cursor-pointer" id="main-menu-close">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        <div class="p-4 space-y-1">
            {menuItems.map((item) => (
                item.children && item.children.length > 0 ? (
                    /* Mobile Dropdown - Accordion */
                    <div class="mobile-accordion">
                        <button 
                            type="button"
                            class={`w-full flex items-center justify-between px-4 py-3 text-base font-medium rounded-xl transition-colors cursor-pointer ${isActivePath(currentPath, item.url) ? 'text-primary bg-primary/10' : 'text-content-light hover:text-content hover:bg-surface-alt'}`}
                            data-accordion-trigger
                        >
                            {item.label}
                            <svg class="w-5 h-5 transition-transform accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="hidden accordion-content pl-4 space-y-1 mt-1">
                            <a 
                                href={item.url}
                                class={`block px-4 py-2.5 text-sm font-medium rounded-lg transition-all no-underline cursor-pointer ${isActivePath(currentPath, item.url, true) ? 'text-primary bg-primary/5' : 'text-content-light hover:text-content hover:bg-surface-alt'}`}
                            >
                                {item.label}
                            </a>
                            {item.children.map((child) => (
                                <a 
                                    href={child.url}
                                    class={`block px-4 py-2.5 text-sm font-medium rounded-lg transition-all no-underline cursor-pointer ${isActivePath(currentPath, child.url, true) ? 'text-primary bg-primary/5' : 'text-content-light hover:text-content hover:bg-surface-alt'}`}
                                >
                                    {child.label}
                                </a>
                            ))}
                        </div>
                    </div>
                ) : (
                    /* Mobile Regular Item */
                    <a 
                        href={item.url}
                        target={item.type === 'custom' && item.url.startsWith('http') ? '_blank' : undefined}
                        rel={item.type === 'custom' && item.url.startsWith('http') ? 'noopener noreferrer' : undefined}
                        class={`block px-4 py-3 text-base font-medium rounded-xl transition-colors no-underline cursor-pointer ${isActivePath(currentPath, item.url, item.url === '/') ? 'text-primary bg-primary/10' : 'text-content-light hover:text-content hover:bg-surface-alt'}`}
                    >
                        {item.label}
                    </a>
                )
            ))}
        </div>
    </nav>
</div>

<script>
    // Mobile menu functionality
    const toggle = document.getElementById('main-menu-toggle');
    const mobile = document.getElementById('main-menu-mobile');
    const overlay = document.getElementById('main-menu-overlay');
    const close = document.getElementById('main-menu-close');
    const hamburgerIcon = toggle?.querySelector('.hamburger-icon');
    const closeIcon = toggle?.querySelector('.close-icon');

    function openMenu() {
        mobile?.classList.remove('hidden');
        hamburgerIcon?.classList.add('hidden');
        closeIcon?.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
        mobile?.classList.add('hidden');
        hamburgerIcon?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
        document.body.style.overflow = '';
    }

    toggle?.addEventListener('click', () => {
        if (mobile?.classList.contains('hidden')) {
            openMenu();
        } else {
            closeMenu();
        }
    });

    overlay?.addEventListener('click', closeMenu);
    close?.addEventListener('click', closeMenu);

    // Mobile accordion
    document.querySelectorAll('#main-menu-mobile [data-accordion-trigger]').forEach(trigger => {
        trigger.addEventListener('click', () => {
            const parent = trigger.closest('.mobile-accordion');
            if (!parent) return;
            const content = parent.querySelector('.accordion-content');
            const icon = trigger.querySelector('.accordion-icon');
            if (content && icon) {
                content.classList.toggle('hidden');
                icon.classList.toggle('rotate-180');
            }
        });
    });

    // Close on escape
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !mobile?.classList.contains('hidden')) {
            closeMenu();
        }
    });
</script>
