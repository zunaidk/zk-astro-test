---
name: astro-wordpress
description: Expert guide for building Astro static sites powered by WordPress. Use when editing Astro components, pages, layouts, WordPress integration, Tailwind styling, fonts, icons, SEO, or navigation. Covers all project conventions and available APIs.
---

# Astro WordPress Development

## Rules

- Astro uses `class=` (not `className=`), frontmatter between `---` markers, no React hooks
- API endpoints: Use `.ts` files (e.g., `src/pages/api/submit.ts`) with `export const prerender = false;` at the top
- WordPress content: `set:html={post.content.rendered}`
- Images: import local images; remote images need explicit width/height
- **Tailwind V4 only** (not V3) - never use `<style>` tags or inline CSS; prefer theme tokens (`bg-surface`, `text-content`, `bg-primary`)
- Clickable elements must have `cursor-pointer`
- Flag security issues; make minimal diffs
- Frontmatter uses TypeScript - always define proper types/interfaces

## Generated Files (DO NOT MODIFY)

These files are auto-generated and may be overwritten. **Never edit them:**
- `src/lib/wordpress.ts` - regenerated on WP reconnect
- `src/lib/navigation.ts` - navigation utilities
- `src/components/menus/*.astro` - regenerated by Menu Builder
- `src/layouts/BaseLayout.astro` - base HTML shell

**Instead, use these extension points:**
- `src/lib/functions.ts` - custom data-fetching helpers (import `makeCMSRequest` from `./wordpress`)
- Menu slots: `<MainMenu><a href="/link">Custom</a></MainMenu>` (default slot = desktop, `mobile` slot = mobile menu)
- Create new components in `src/components/`

## Dev Server

Astro HMR handles .astro, .css, and .ts changes automatically. Only restart the dev server after installing packages or changing config files (astro.config.mjs, package.json, tsconfig.json).

## Discovering WordPress Data

**Before building pages**, use the AI tools in the chat panel to understand what data is available:

1. **get_wordpress_schema** - Returns the full site schema: all post types (with rest_base), taxonomies, ACF field groups and fields, and detected plugins. Always call this first.
2. **fetch_wp_sample** - Fetches a real WordPress post with actual ACF data values. Use when `get_wordpress_schema` shows "unknown" field types or you need to see repeater/flexible content sub-field structures. Pass `restBase` (e.g., "team-member") and optionally `id` for a specific post.

For manual queries in code, use `makeCMSRequest` (auth is automatic -- secret is in `wordpress.ts`):

```typescript
// makeCMSRequest returns { success, data, error } -- always destructure data
const { data: types } = await makeCMSRequest('/wp/v2/types');         // post types
const { data: taxonomies } = await makeCMSRequest('/wp/v2/taxonomies'); // taxonomies
const { data: sample } = await makeCMSRequest('/wp/v2/{rest_base}?per_page=1&_embed&acf_format=standard'); // inspect structure (acf_format=standard expands ACF values)
```

Custom post types have their own REST endpoint (`rest_base`). ACF fields appear in the `acf` property. See [wordpress.md](wordpress.md) for full details.

## WordPress Functions (src/lib/wordpress.ts)

```typescript
getPosts()                              // Get all posts
getPost(slug)                           // Get single post by slug
getPages()                              // Get all pages
getPage(slug)                           // Get single page by slug
getFeaturedImageUrl(post, size)         // sizes: thumbnail, medium, large, full
formatDate(date)                        // Format a date string
makeCMSRequest(route, body?, options?)  // Custom WordPress REST API request
submitFluentForm(formId, fields)        // Submit a Fluent Form
createComment(postId, content, {name, email})
```

## Navigation (src/lib/navigation.ts)

```typescript
getNavigationPages()                    // Get pages for nav
getMenuItems()                          // Menu items from Menu Builder
isActivePath(path, target, exact?)      // Check active state
getBreadcrumbs(pathname)                // Breadcrumb trail
```

## Menus (src/components/menus/)

Created via Menu Builder UI, saved as components (`<MainMenu/>`, `<FooterMenu/>`). Config in `src/config/menus.json`.

## Fonts

- **FIRST** check `package.json` for `@fontsource/*` - if font exists, just update theme.css (no install needed!)
- To install new: `npm install @fontsource/{id}` then import in `BaseLayout.astro`
- To use: update `--font-sans` in `src/styles/theme.css`
- `@fontsource/inter` and `@fontsource-variable/inter` both use font-family: `'Inter'`

For detailed font guide, see [fonts.md](fonts.md)

## Icons (@lucide/astro)

Always import icons individually (not from barrel) for faster HMR:

```astro
---
import ArrowRight from '@lucide/astro/icons/arrow-right';
import Mail from '@lucide/astro/icons/mail';
import Phone from '@lucide/astro/icons/phone';
---
<ArrowRight class="w-5 h-5 text-primary" />
```

Common icons: ArrowRight, ArrowLeft, ChevronDown, Menu, X, Plus, Edit, Trash, Mail, Phone, Search, Settings, User, Home, Star, Check, AlertCircle

For full icon guide, see [icons.md](icons.md)

## Tailwind V4 Theme (src/styles/theme.css)

Tokens in `@theme { }` blocks create utility classes:
- `--color-primary` -> `bg-primary`, `text-primary`, `border-primary`
- `--color-surface` -> `bg-surface` (page background)
- `--color-surface-alt` -> `bg-surface-alt` (cards)
- `--color-content` -> `text-content` (main text)
- `--color-content-light` -> `text-content-light` (secondary text)
- `--color-outline` -> `border-outline` (borders)
- `--font-sans`, `--font-mono`, `--font-heading`

For detailed theming guide, see [tailwind.md](tailwind.md)

## Layouts

**NEVER use BaseLayout directly in pages.** BaseLayout is the low-level shell (head, scripts, styles) -- it does NOT include Header, Footer, or page structure.

Always use one of these:

- **PageLayout** (`src/layouts/PageLayout.astro`) - For pages with custom components, grids, cards. No prose styling. Use as `layout: '@layouts/PageLayout.astro'` in MDX.
- **ContentLayout** (`src/layouts/ContentLayout.astro`) - For text-heavy MDX pages (articles, docs). Includes `prose` typography. Use as `layout: '@layouts/ContentLayout.astro'` in MDX.

MDX frontmatter example: `layout: '@layouts/PageLayout.astro'`

For .astro pages, import and wrap: `import PageLayout from '../layouts/PageLayout.astro';` then use `<PageLayout frontmatter={{ title: 'My Page' }}><slot content /></PageLayout>`

## Astro Component Patterns

```astro
---
interface Props {
    title: string;
    description?: string;
}
const { title, description = '' } = Astro.props;
---

<div class="bg-surface-alt rounded-lg p-6 border border-outline">
    <h3 class="text-lg font-semibold text-content">{title}</h3>
    {description && <p class="text-content-light mt-2">{description}</p>}
    <slot />
</div>
```

- Use `<slot />` for children (not `{children}`)
- Use `class:list={[...]}` for conditional classes
- Dynamic routes: `[...slug].astro` with `getStaticPaths()`

For more patterns, see [components.md](components.md)

## SEO

For SEO and meta tags guide, see [seo.md](seo.md)

## WordPress Integration

For detailed WordPress API guide with examples, see [wordpress.md](wordpress.md)

## Project Structure

- `src/pages/` - Astro pages and routes
- `src/components/` - Reusable Astro components
- `src/layouts/` - Layout components (PageLayout, ContentLayout, BaseLayout)
- `src/lib/` - Utilities (wordpress.ts, navigation.ts)
- `src/styles/` - Theme and global styles (theme.css, global.css)
- `src/config/` - Configuration files (menus.json)
- `docs/ai-instructions.md` - Custom user instructions (read this)
- `docs/notes.md` - Project notes scratchpad
